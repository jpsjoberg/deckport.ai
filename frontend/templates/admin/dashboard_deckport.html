{% extends "admin/base_deckport_design.html" %}

{% block title %}Executive Dashboard - Deckport Admin{% endblock %}
{% block page_title %}Executive Dashboard{% endblock %}
{% block page_subtitle %}Real-time system overview and critical metrics{% endblock %}

{% block content %}
<!-- System Status Alert -->
<div class="mb-8" id="system-status">
    {% if stats.system_health == 'good' %}
    <div class="alert-success">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-green-400 mr-3"></i>
            <div>
                <h3 class="text-sm font-medium text-white">All Systems Operational</h3>
                <p class="text-sm text-green-200 mt-1">{{ stats.active_consoles }}/{{ stats.total_consoles }} consoles online • {{ stats.live_matches }} active matches</p>
            </div>
        </div>
    </div>
    {% elif stats.system_health == 'warning' %}
    <div class="alert-warning">
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-yellow-400 mr-3"></i>
            <div>
                <h3 class="text-sm font-medium text-white">System Status: Warning</h3>
                <p class="text-sm text-yellow-200 mt-1">Some consoles may be experiencing issues</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert-error">
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-red-400 mr-3"></i>
            <div>
                <h3 class="text-sm font-medium text-white">System Issues Detected</h3>
                <p class="text-sm text-red-200 mt-1">Critical systems require attention</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Key Metrics Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Active Consoles -->
    <div class="metric-card">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                    <i class="fas fa-desktop text-xl text-white"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-white">Active Consoles</h3>
                    <p class="text-xs text-gray-400">Fleet Status</p>
                </div>
            </div>
        </div>
        <div class="flex items-baseline justify-between">
            <div>
                <span class="text-4xl font-bold text-blue-400">{{ stats.active_consoles or 0 }}</span>
                <span class="text-xl text-gray-400 ml-1">/{{ stats.total_consoles or 0 }}</span>
            </div>
            <div class="text-right">
                <span class="text-sm font-medium text-green-400">
                    {{ "%.1f"|format((stats.active_consoles / stats.total_consoles * 100) if stats.total_consoles > 0 else 0) }}%
                </span>
                <p class="text-xs text-gray-500">Uptime</p>
            </div>
        </div>
    </div>

    <!-- Live Matches -->
    <div class="metric-card">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <i class="fas fa-gamepad text-xl text-white"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-white">Live Matches</h3>
                    <p class="text-xs text-gray-400">Active Games</p>
                </div>
            </div>
        </div>
        <div class="flex items-baseline justify-between">
            <span class="text-4xl font-bold text-green-400">{{ stats.live_matches or 0 }}</span>
            <div class="text-right">
                <span class="text-sm font-medium text-gray-300">Real-time</span>
                <p class="text-xs text-gray-500">Active Now</p>
            </div>
        </div>
    </div>

    <!-- Online Players -->
    <div class="metric-card">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    <i class="fas fa-users text-xl text-white"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-white">Online Players</h3>
                    <p class="text-xs text-gray-400">Currently Active</p>
                </div>
            </div>
        </div>
        <div class="flex items-baseline justify-between">
            <span class="text-4xl font-bold text-purple-400">{{ stats.online_players or 0 }}</span>
            <div class="text-right">
                <span class="text-sm font-medium text-purple-300">Live</span>
                <p class="text-xs text-gray-500">Players</p>
            </div>
        </div>
    </div>

    <!-- NFC Cards -->
    <div class="metric-card">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <i class="fas fa-microchip text-xl text-white"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-white">NFC Cards</h3>
                    <p class="text-xs text-gray-400">Physical Assets</p>
                </div>
            </div>
        </div>
        <div class="flex items-baseline justify-between">
            <span class="text-4xl font-bold text-yellow-400">{{ stats.total_nfc_cards or 0 }}</span>
            <div class="text-right">
                <span class="text-sm font-medium text-yellow-300">{{ stats.activated_cards or 0 }}</span>
                <p class="text-xs text-gray-500">Activated</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions Section -->
<div class="mb-8">
    <h2 class="text-2xl font-bold gradient-text mb-6">
        <i class="fas fa-bolt mr-3"></i>Quick Actions
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Card Generation -->
        <div class="admin-card p-6 cursor-pointer" onclick="window.location.href='{{ url_for('admin.card_generation') }}'">
            <div class="flex items-center justify-between mb-4">
                <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    <i class="fas fa-magic text-2xl text-white"></i>
                </div>
                <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Generate Cards</h3>
            <p class="text-gray-400 text-sm mb-4">Create new card artwork and assets using AI generation</p>
            <div class="flex items-center text-purple-400 font-medium">
                <span>Start Generation</span>
                <i class="fas fa-chevron-right ml-2"></i>
            </div>
        </div>

        <!-- Game Operations -->
        <div class="admin-card p-6 cursor-pointer" onclick="window.location.href='{{ url_for('admin.game_operations') }}'">
            <div class="flex items-center justify-between mb-4">
                <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <i class="fas fa-gamepad text-2xl text-white"></i>
                </div>
                <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Game Operations</h3>
            <p class="text-gray-400 text-sm mb-4">Monitor live matches, tournaments, and player activity</p>
            <div class="flex items-center text-green-400 font-medium">
                <span>View Operations</span>
                <i class="fas fa-chevron-right ml-2"></i>
            </div>
        </div>

        <!-- Console Fleet -->
        <div class="admin-card p-6 cursor-pointer" onclick="window.location.href='{{ url_for('admin.console_management') }}'">
            <div class="flex items-center justify-between mb-4">
                <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                    <i class="fas fa-desktop text-2xl text-white"></i>
                </div>
                <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Console Fleet</h3>
            <p class="text-gray-400 text-sm mb-4">Manage gaming consoles, locations, and health monitoring</p>
            <div class="flex items-center text-blue-400 font-medium">
                <span>Manage Fleet</span>
                <i class="fas fa-chevron-right ml-2"></i>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Recent Activity -->
    <div class="lg:col-span-2">
        <div class="admin-card p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                <i class="fas fa-clock mr-3 text-blue-400"></i>
                Recent Activity
            </h3>
            <div class="space-y-4" id="recent-activity">
                {% if stats.recent_cards %}
                    {% for card in stats.recent_cards[:8] %}
                    <div class="flex items-center justify-between py-3 border-b border-gray-700 border-opacity-50 last:border-b-0">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                <i class="fas fa-magic text-white"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-white">{{ card.name }}</p>
                                <p class="text-xs text-gray-400">{{ card.category }} • {{ card.rarity }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">{{ card.created_at[:10] if card.created_at else 'Today' }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-inbox text-4xl text-gray-600 mb-4"></i>
                    <p class="text-gray-400">No recent activity</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- System Health -->
    <div class="space-y-6">
        <!-- Health Overview -->
        <div class="admin-card p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                <i class="fas fa-heartbeat mr-3 text-red-400"></i>
                System Health
            </h3>
            <div class="space-y-4">
                <!-- Database -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="status-indicator status-healthy"></span>
                        <span class="text-sm text-white">Database</span>
                    </div>
                    <span class="text-xs admin-card px-3 py-1 rounded-full text-green-300">Healthy</span>
                </div>

                <!-- API Services -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="status-indicator status-healthy"></span>
                        <span class="text-sm text-white">API Services</span>
                    </div>
                    <span class="text-xs admin-card px-3 py-1 rounded-full text-green-300">Online</span>
                </div>

                <!-- Console Network -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="status-indicator {% if stats.active_consoles > 0 %}status-healthy{% else %}status-warning{% endif %}"></span>
                        <span class="text-sm text-white">Console Network</span>
                    </div>
                    <span class="text-xs admin-card px-3 py-1 rounded-full {% if stats.active_consoles > 0 %}text-green-300{% else %}text-yellow-300{% endif %}">
                        {{ stats.active_consoles }} Active
                    </span>
                </div>

                <!-- Game Engine -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="status-indicator status-healthy"></span>
                        <span class="text-sm text-white">Game Engine</span>
                    </div>
                    <span class="text-xs admin-card px-3 py-1 rounded-full text-green-300">Ready</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="admin-card p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                <i class="fas fa-chart-line mr-3 text-blue-400"></i>
                Quick Stats
            </h3>
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-300">Total Cards</span>
                    <span class="text-lg font-bold text-white">{{ (stats.recent_cards|length * 100) if stats.recent_cards else 0 }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-300">Active Players</span>
                    <span class="text-lg font-bold text-white">{{ stats.online_players or 0 }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-300">NFC Cards</span>
                    <span class="text-lg font-bold text-white">{{ stats.total_nfc_cards or 0 }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-300">Uptime</span>
                    <span class="text-lg font-bold text-green-400">99.9%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Console Activity Chart -->
    <div class="admin-card p-6">
        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
            <i class="fas fa-chart-area mr-3 text-blue-400"></i>
            Console Activity
        </h3>
        <div class="h-64 flex items-center justify-center">
            <div class="text-center">
                <i class="fas fa-chart-line text-4xl text-gray-600 mb-4"></i>
                <p class="text-gray-400">Activity chart will be rendered here</p>
                <p class="text-xs text-gray-500 mt-2">Real-time console usage data</p>
            </div>
        </div>
    </div>

    <!-- Player Activity Chart -->
    <div class="admin-card p-6">
        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
            <i class="fas fa-chart-bar mr-3 text-green-400"></i>
            Player Activity
        </h3>
        <div class="h-64 flex items-center justify-center">
            <div class="text-center">
                <i class="fas fa-chart-bar text-4xl text-gray-600 mb-4"></i>
                <p class="text-gray-400">Player chart will be rendered here</p>
                <p class="text-xs text-gray-500 mt-2">Player engagement metrics</p>
            </div>
        </div>
    </div>
</div>

<!-- System Overview -->
<div class="admin-card p-6">
    <h3 class="text-xl font-bold text-white mb-6 flex items-center">
        <i class="fas fa-server mr-3 text-purple-400"></i>
        System Overview
    </h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- API Endpoints -->
        <div class="text-center">
            <div class="w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                <i class="fas fa-plug text-2xl text-white"></i>
            </div>
            <h4 class="text-lg font-bold text-white">120+</h4>
            <p class="text-sm text-gray-400">API Endpoints</p>
        </div>

        <!-- Database Tables -->
        <div class="text-center">
            <div class="w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <i class="fas fa-database text-2xl text-white"></i>
            </div>
            <h4 class="text-lg font-bold text-white">25+</h4>
            <p class="text-sm text-gray-400">Database Tables</p>
        </div>

        <!-- Security Features -->
        <div class="text-center">
            <div class="w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <i class="fas fa-shield-alt text-2xl text-white"></i>
            </div>
            <h4 class="text-lg font-bold text-white">RBAC</h4>
            <p class="text-sm text-gray-400">Security System</p>
        </div>

        <!-- Monitoring -->
        <div class="text-center">
            <div class="w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <i class="fas fa-eye text-2xl text-white"></i>
            </div>
            <h4 class="text-lg font-bold text-white">24/7</h4>
            <p class="text-sm text-gray-400">Monitoring</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Enhanced dashboard with real-time updates
document.addEventListener('DOMContentLoaded', function() {
    // Load real-time data
    loadDashboardData();
    
    // Auto-refresh every 30 seconds
    setInterval(loadDashboardData, 30000);
});

async function loadDashboardData() {
    try {
        const data = await apiCall('/admin/api/dashboard/stats');
        
        if (data && !data.error) {
            // Update metrics
            updateMetric('console-count', data.active_consoles || 0);
            updateMetric('console-total', `/${data.total_consoles || 0}`);
            updateMetric('match-count', data.live_matches || 0);
            updateMetric('player-count', data.online_players || 0);
            updateMetric('nfc-count', data.total_nfc_cards || 0);
            
            // Update system status
            updateSystemStatus(data);
        }
    } catch (error) {
        console.log('Real-time data not available, using cached data');
    }
}

function updateMetric(elementId, value) {
    const element = document.getElementById(elementId);
    if (element) {
        element.textContent = value;
    }
}

function updateSystemStatus(data) {
    const statusElement = document.getElementById('system-status');
    if (!statusElement) return;
    
    const isHealthy = data.active_consoles > 0 && data.system_health !== 'error';
    
    if (isHealthy) {
        statusElement.innerHTML = `
            <div class="alert-success">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-400 mr-3"></i>
                    <div>
                        <h3 class="text-sm font-medium text-white">All Systems Operational</h3>
                        <p class="text-sm text-green-200 mt-1">${data.active_consoles}/${data.total_consoles} consoles online • ${data.live_matches} active matches</p>
                    </div>
                </div>
            </div>
        `;
    }
}

// Add smooth animations to metric cards
document.querySelectorAll('.metric-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px) scale(1.02)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0) scale(1)';
    });
});
</script>
{% endblock %}
